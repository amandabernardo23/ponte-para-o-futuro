<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title> Página da Instituição</title>
  <link rel="stylesheet" href="instituicao.css" />
  <script src="script.js" defer></script>
</head>
<body class="instituicao">
  <div class="dashboard">
    <aside class="sidebar">
      <img src="assets/iconuser.png" alt="Foto da Instituição" class="profile-pic" />
      <p class="institution-name"></p>
       <button onclick="mostrarSecao('painel')">Painel Inicial</button>
       <button onclick="mostrarSecao('projetos')">Cadastro de Projetos</button>
       <button onclick="mostrarSecao('listar-projetos')">Visualizar Projetoss</button>
       <button onclick="mostrarSecao('usuarios')">Alunos</button>
      <a href="login.html" class="back-button"> Sair </a>
    </aside>

     <main class="main-content">
      <!-- Painel Inicial -->
      <section id="painel" class="secao-dashboard active">
        <h2>Bem-vindo(a) ao Painel da Instituição</h2>
        <p>Este é o seu centro de controle. Abaixo, você encontra informações úteis e um resumo geral.</p>
        <div class="dashboard-cards">
          <div class="card">
            <h3>Alunos Cadastrados</h3>
            <p id="count-alunos"></p>
          </div>
          <div class="card">
            <h3>Projetos Ativos</h3>
            <p id="count-projetos"></p>
          </div>
          <div class="card">
            <h3>Último Cadastro</h3>
            <p id="last-cadastro"></p>
          </div>
        </div>
      </section>

     <section id="projetos" class="secao-dashboard">
        <h2>Cadastro de Projetos</h2>
        <form id="form-projetos" method="POST">
          <input type="text" name="titulo" placeholder="Título do Projeto" required/>
          <textarea name="descricao" placeholder="Descrição do Projeto" rows="4"></textarea>
          <input type="date" name="data_inicio" placeholder="Data de início" required/>
          <input type="date" name="data_termino" placeholder="Data do término" required/>
          <button type="submit">Cadastrar Projeto</button>
        </form>
      </section> 

      <section id="listar-projetos" class="secao-dashboard">
        <h2>Projetos Cadastrados</h2>
        <table border="1">
          <thead>
            <tr>
              <th>  Id  </th>
              <th>  Título  </th>
              <th>  Descrição  </th>
              <th>  Status  </th>
              <th>  Data Início  </th>
              <th>  Data Término  </th>
            </tr>
          </thead>
          <tbody id="tabela-projetos">
          <!-- Conteúdo será preenchido via JavaScript -->
          </tbody>
          </table>
      </section>

      <section id="usuarios" class="secao-dashboard">
        
        <h2>Alunos Cadastrados</h2>
        <table border="1">
          <thead>
            <tr>
              <th>  ID  </th>
              <th>  Nome  </th>
              <th>  Email  </th>
            </tr>
          </thead>
          <tbody id="corpo-tabela-alunos">
          <!-- Os alunos serão carregados aqui via script.js -->
          </tbody>
        </table>
      </section> 
    </main>

  <script>
    function mostrarSecao(secaoId) {
      const secoes = document.querySelectorAll('.secao-dashboard');
      secoes.forEach(secao => secao.classList.remove('active'));
      document.getElementById(secaoId).classList.add('active');
    }

  </script>
  
  <script>
  document.addEventListener("DOMContentLoaded", () => {
    const dados = localStorage.getItem("usuarioLogado");

    if (dados) {
      const usuario = JSON.parse(dados);

      // Exemplo: verificar o tipo
      if (usuario.tipo !== "instituicao") {
        alert("Acesso não autorizado.");
        window.location.href = "login.html";
      }

      // Aqui você pode usar os dados do usuário normalmente
      console.log("Usuário logado:", usuario.nome);
    } else {
      // Redireciona se não estiver logado
      window.location.href = "login.html";
    }
  });
</script>


<script>
  function mostrarSecao(secaoId) {
    const secoes = document.querySelectorAll('.secao-dashboard');
    secoes.forEach(secao => secao.classList.remove('active'));
    document.getElementById(secaoId)?.classList.add('active');
  }

  window.addEventListener('DOMContentLoaded', () => {
    // Verifica se o tipo de usuário está correto
    const tipoUsuario = localStorage.getItem("tipoUsuario");
    if (tipoUsuario !== "instituicao") {
      // Redireciona para a tela de login se não for do tipo "instituicao"
      window.location.href = "login.html";
      return;
    }

    const nomeInstituicao = localStorage.getItem("instituicaoNome") || "Instituição";

    // Atualiza o nome no menu lateral
    const nomeElemento = document.querySelector('.institution-name');
    if (nomeElemento) {
      nomeElemento.textContent = nomeInstituicao;
    }

    // Atualiza o título da seção principal
    const painelTitulo = document.querySelector('#painel h2');
    if (painelTitulo) {
      painelTitulo.textContent = `Bem-vindo(a), ${nomeInstituicao}!`;
    }
  });
</script>

<!-- Ativa o cadastro de projeto com a URL correta -->
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const ativarCadastroProjeto = criarCadastroProjetoHandler("http://localhost:3000/api/projetos");
    ativarCadastroProjeto();
  });
</script>

</body>
</html>
